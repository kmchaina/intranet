@extends('layouts.dashboard') @section('title', 'Poll Results') @section('page-title', 'Poll Results: ' . $poll->title) @section('content') <div class="flex justify-between items-center mb-6"> <h1 class="text-2xl font-bold text-gray-900">Poll Results: {{ $poll->title }}</h1> <div class="flex items-center gap-2"> @if ($poll->canManage(auth()->user())) <a href="{{ route('polls.edit', $poll) }}" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"> Edit Poll </a> @endif <a href="{{ route('polls.show', $poll) }}" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"> View Poll </a> <a href="{{ route('polls.index') }}" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"> Back to Polls </a> </div> </div> <!-- Poll Info --> <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg mb-6"> <div class="p-6"> <div class="flex items-center gap-3 mb-4"> <span class="px-3 py-1 text-sm font-semibold rounded-full @if ($poll->status === 'active') bg-green-100 text-green-800 @elseif($poll->status === 'draft') bg-gray-100 text-gray-800 @elseif($poll->status === 'closed') bg-yellow-100 text-yellow-800 @else bg-red-100 text-red-800 @endif"> {{ ucfirst($poll->status) }} </span> <span class="px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded-full"> {{ $poll->getTypeLabel() }} </span> @if ($poll->anonymous) <span class="px-3 py-1 text-sm bg-purple-100 text-purple-800 rounded-full"> Anonymous </span> @endif </div> @if ($poll->description) <p class="text-gray-700 mb-4">{{ $poll->description }}</p> @endif <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm text-gray-600"> <div> <span class="font-medium">Created by:</span> {{ $poll->creator->name }} </div> <div> <span class="font-medium">Created:</span> {{ $poll->created_at->format('M j, Y') }} </div> <div> <span class="font-medium">Total Responses:</span> {{ $totalResponses }} </div> <div> @if ($poll->ends_at) <span class="font-medium">Ends:</span> {{ $poll->ends_at->diffForHumans() }} @else <span class="font-medium">No end date</span> @endif </div> </div> </div> </div> <div class="grid grid-cols-1 lg:grid-cols-3 gap-6"> <!-- Main Results --> <div class="lg:col-span-2"> <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg"> <div class="p-6"> <h3 class="text-lg font-semibold mb-6">Results</h3> @if ($totalResponses === 0) <div class="text-center py-8 text-gray-500"> <p>No responses yet.</p> </div> @elseif($poll->type === 'rating') <div class="mb-8"> <div class="text-center mb-6"> <div class="text-4xl font-bold text-blue-600"> {{ $results['average'] }}/{{ $poll->max_rating }} </div> <div class="text-gray-600"> Average rating from {{ $results['total_responses'] }} responses </div> </div> <div class="space-y-3"> @foreach (array_reverse($results['breakdown'], true) as $ratingData) <div class="flex items-center"> <span class="w-8 text-sm font-medium">{{ $ratingData['rating'] }}</span> <div class="flex-1 mx-3 bg-gray-200 rounded-full h-6 relative"> <div class="bg-blue-500 h-6 rounded-full transition-all duration-500" style="width: {{ $ratingData['percentage'] }}%"></div> <div class="absolute inset-0 flex items-center justify-center text-xs text-white font-medium"> {{ $ratingData['count'] }} </div> </div> <span class="w-16 text-sm text-right font-medium">{{ $ratingData['percentage'] }}%</span> </div> @endforeach </div> </div> @elseif($poll->type === 'yes_no') <div class="space-y-4"> <div class="flex items-center"> <span class="w-20 text-lg font-medium text-green-600">Yes</span> <div class="flex-1 mx-4 bg-gray-200 rounded-full h-8 relative"> <div class="bg-green-500 h-8 rounded-full transition-all duration-500" style="width: {{ $results['yes']['percentage'] }}%"></div> <div class="absolute inset-0 flex items-center justify-center text-sm text-white font-medium"> {{ $results['yes']['count'] }} </div> </div> <span class="w-16 text-sm text-right font-medium">{{ $results['yes']['percentage'] }}%</span> </div> <div class="flex items-center"> <span class="w-20 text-lg font-medium text-red-600">No</span> <div class="flex-1 mx-4 bg-gray-200 rounded-full h-8 relative"> <div class="bg-red-500 h-8 rounded-full transition-all duration-500" style="width: {{ $results['no']['percentage'] }}%"></div> <div class="absolute inset-0 flex items-center justify-center text-sm text-white font-medium"> {{ $results['no']['count'] }} </div> </div> <span class="w-16 text-sm text-right font-medium">{{ $results['no']['percentage'] }}%</span> </div> </div> @else <!-- Choice-based results --> <div class="space-y-4"> @foreach ($results as $index => $result) <div> <div class="flex justify-between items-center mb-2"> <span class="font-medium">{{ $result['option'] }}</span> <span class="text-sm text-gray-600">{{ $result['count'] }} votes ({{ $result['percentage'] }}%)</span> </div> <div class="w-full bg-gray-200 rounded-full h-4"> <div class="bg-blue-500 h-4 rounded-full transition-all duration-500" style="width: {{ $result['percentage'] }}%"></div> </div> </div> @endforeach </div> @endif </div> </div> </div> <!-- Sidebar --> <div class="lg:col-span-1 space-y-6"> <!-- Department Breakdown --> @if ($departmentBreakdown && $departmentBreakdown->count() > 0) <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg"> <div class="p-6"> <h3 class="text-lg font-semibold mb-4">Responses by Department</h3> <div class="space-y-3"> @foreach ($departmentBreakdown as $dept) <div class="flex justify-between items-center"> <span class="text-sm">{{ $dept->department ?: 'No Department' }}</span> <span class="text-sm font-medium bg-gray-100 px-2 py-1 rounded"> {{ $dept->count }} </span> </div> @endforeach </div> </div> </div> @endif <!-- Quick Stats --> <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg"> <div class="p-6"> <h3 class="text-lg font-semibold mb-4">Quick Stats</h3> <div class="space-y-3 text-sm"> <div class="flex justify-between"> <span>Total Responses:</span> <span class="font-semibold">{{ $totalResponses }}</span> </div> <div class="flex justify-between"> <span>Response Rate:</span> <span class="font-semibold"> @php $totalUsers = \App\Models\User::count(); $responseRate = $totalUsers > 0 ? round(($totalResponses / $totalUsers) * 100, 1) : 0; @endphp {{ $responseRate }}% </span> </div> @if ($poll->created_at) <div class="flex justify-between"> <span>Running Time:</span> <span class="font-semibold">{{ $poll->created_at->diffForHumans(null, true) }}</span> </div> @endif @if ($poll->allow_comments) @php $commentsCount = \App\Models\PollResponse::where('poll_id', $poll->id) ->whereNotNull('comment') ->count(); @endphp <div class="flex justify-between"> <span>Comments:</span> <span class="font-semibold">{{ $commentsCount }}</span> </div> @endif </div> </div> </div> <!-- Export Options --> @if ($poll->canManage(auth()->user()) && $totalResponses > 0) <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg"> <div class="p-6"> <h3 class="text-lg font-semibold mb-4">Export Data</h3> <div class="space-y-2"> <button onclick="exportToCSV()" class="w-full bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded text-sm"> Export as CSV </button> <button onclick="printResults()" class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded text-sm"> Print Results </button> </div> </div> </div> @endif <!-- Poll Actions --> @if ($poll->canManage(auth()->user())) <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg"> <div class="p-6"> <h3 class="text-lg font-semibold mb-4">Poll Actions</h3> <div class="space-y-2"> @if ($poll->status === 'active') <form method="POST" action="{{ route('polls.update', $poll) }}"> @csrf @method('PATCH') <input type="hidden" name="status" value="closed"> <input type="hidden" name="title" value="{{ $poll->title }}"> <input type="hidden" name="description" value="{{ $poll->description }}"> <input type="hidden" name="visibility" value="{{ $poll->visibility }}"> <input type="hidden" name="show_results" value="{{ $poll->show_results ? '1' : '0' }}"> <input type="hidden" name="allow_comments" value="{{ $poll->allow_comments ? '1' : '0' }}"> <button type="submit" class="w-full bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded text-sm" onclick="return confirm('Close this poll? No more votes will be accepted.')"> Close Poll </button> </form> @elseif($poll->status === 'closed') <form method="POST" action="{{ route('polls.update', $poll) }}"> @csrf @method('PATCH') <input type="hidden" name="status" value="active"> <input type="hidden" name="title" value="{{ $poll->title }}"> <input type="hidden" name="description" value="{{ $poll->description }}"> <input type="hidden" name="visibility" value="{{ $poll->visibility }}"> <input type="hidden" name="show_results" value="{{ $poll->show_results ? '1' : '0' }}"> <input type="hidden" name="allow_comments" value="{{ $poll->allow_comments ? '1' : '0' }}"> <button type="submit" class="w-full bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded text-sm"> Reopen Poll </button> </form> @endif </div> </div> </div> @endif </div> </div> </div> </div> @push('scripts') <script> function exportToCSV() { const pollData = @json([ 'poll' => $poll->only(['title', 'type', 'created_at']), 'results' => $results, 'totalResponses' => $totalResponses, ]); let csvContent = "data:text/csv;charset=utf-8,"; csvContent += "Poll: " + pollData.poll.title + "\n"; csvContent += "Type: " + pollData.poll.type + "\n"; csvContent += "Total Responses: " + pollData.totalResponses + "\n"; csvContent += "Created: " + pollData.poll.created_at + "\n\n"; @if ($poll->type === 'rating') csvContent += "Rating,Count,Percentage\n"; @foreach ($results['breakdown'] as $rating) csvContent += "{{ $rating['rating'] }},{{ $rating['count'] }},{{ $rating['percentage'] }}%\n"; @endforeach @elseif ($poll->type === 'yes_no') csvContent += "Option,Count,Percentage\n"; csvContent += "Yes,{{ $results['yes']['count'] }},{{ $results['yes']['percentage'] }}%\n"; csvContent += "No,{{ $results['no']['count'] }},{{ $results['no']['percentage'] }}%\n"; @else csvContent += "Option,Count,Percentage\n"; @foreach ($results as $result) csvContent += "\"{{ addslashes($result['option']) }}\",{{ $result['count'] }},{{ $result['percentage'] }}%\n"; @endforeach @endif const encodedUri = encodeURI(csvContent); const link = document.createElement("a"); link.setAttribute("href", encodedUri); link.setAttribute("download", "poll_results_{{ $poll->id }}.csv"); document.body.appendChild(link); link.click(); document.body.removeChild(link); } function printResults() { window.print(); } </script> @endsection @push('scripts') <script> function exportToCSV() { let csvContent = "data:text/csv;charset=utf-8,"; csvContent += "Poll: {{ addslashes($poll->title) }}\n\n"; @if ($poll->type === 'rating') csvContent += "Rating,Count,Percentage\n"; @foreach ($results['breakdown'] as $rating) csvContent += "{{ $rating['rating'] }},{{ $rating['count'] }},{{ $rating['percentage'] }}%\n"; @endforeach @elseif ($poll->type === 'yes_no') csvContent += "Option,Count,Percentage\n"; csvContent += "Yes,{{ $results['yes']['count'] }},{{ $results['yes']['percentage'] }}%\n"; csvContent += "No,{{ $results['no']['count'] }},{{ $results['no']['percentage'] }}%\n"; @else csvContent += "Option,Count,Percentage\n"; @foreach ($results as $result) csvContent += "\"{{ addslashes($result['option']) }}\",{{ $result['count'] }},{{ $result['percentage'] }}%\n"; @endforeach @endif const encodedUri = encodeURI(csvContent); const link = document.createElement("a"); link.setAttribute("href", encodedUri); link.setAttribute("download", "poll_results_{{ $poll->id }}.csv"); document.body.appendChild(link); link.click(); document.body.removeChild(link); } function printResults() { window.print(); } </script> @endpush 
