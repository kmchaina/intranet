@extends('layouts.dashboard') @section('title', 'Edit Poll') @section('page-title', 'Edit Poll: ' . $poll->title) @section('content') <div class="max-w-4xl mx-auto"> <div class="flex justify-between items-center mb-6"> <h1 class="text-2xl font-bold text-gray-900">Edit Poll: {{ $poll->title }}</h1> <div class="flex items-center gap-2"> <a href="{{ route('polls.show', $poll) }}" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"> View Poll </a> <a href="{{ route('polls.index') }}" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"> Back to Polls </a> </div> </div> <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg"> <div class="p-6"> @if ($poll->responses()->exists()) <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6"> <div class="flex"> <div class="flex-shrink-0"> <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor"> <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" /> </svg> </div> <div class="ml-3"> <h3 class="text-sm font-medium text-yellow-800">Limited Editing</h3> <div class="mt-2 text-sm text-yellow-700"> <p>This poll has received responses, so some options (type, choices, rating scale) cannot be changed to preserve data integrity.</p> </div> </div> </div> </div> @endif <form method="POST" action="{{ route('polls.update', $poll) }}"> @csrf @method('PATCH') <!-- Title --> <div class="mb-6"> <label for="title" class="block text-sm font-medium text-gray-700 mb-2"> Poll Title * </label> <input type="text" name="title" id="title" value="{{ old('title', $poll->title) }}" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" required> @error('title') <p class="mt-1 text-sm text-red-600">{{ $message }}</p> @enderror </div> <!-- Description --> <div class="mb-6"> <label for="description" class="block text-sm font-medium text-gray-700 mb-2"> Description </label> <textarea name="description" id="description" rows="3" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" placeholder="Optional description of the poll">{{ old('description', $poll->description) }}</textarea> @error('description') <p class="mt-1 text-sm text-red-600">{{ $message }}</p> @enderror </div> @if (!$poll->responses()->exists()) <!-- Poll Type --> <div class="mb-6"> <label for="type" class="block text-sm font-medium text-gray-700 mb-2"> Poll Type * </label> <select name="type" id="type" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" required> @foreach (\App\Models\Poll::getTypes() as $value => $label) <option value="{{ $value }}" {{ old('type', $poll->type) === $value ? 'selected' : '' }}> {{ $label }} </option> @endforeach </select> @error('type') <p class="mt-1 text-sm text-red-600">{{ $message }}</p> @enderror </div> <!-- Options for choice-based polls --> <div id="options-section" class="mb-6" style="display: {{ in_array(old('type', $poll->type), ['single_choice', 'multiple_choice']) ? 'block' : 'none' }}"> <label class="block text-sm font-medium text-gray-700 mb-2"> Options * </label> <div id="options-container"> @if ($poll->options) @foreach ($poll->options as $index => $option) <div class="flex items-center mb-2 option-row"> <input type="text" name="options[]" value="{{ old('options.' . $index, $option) }}" class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" placeholder="Option {{ $index + 1 }}"> <button type="button" class="ml-2 text-red-600 hover:text-red-800 remove-option"> Remove </button> </div> @endforeach @else <div class="flex items-center mb-2 option-row"> <input type="text" name="options[]" value="{{ old('options.0') }}" class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" placeholder="Option 1"> <button type="button" class="ml-2 text-red-600 hover:text-red-800 remove-option"> Remove </button> </div> <div class="flex items-center mb-2 option-row"> <input type="text" name="options[]" value="{{ old('options.1') }}" class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" placeholder="Option 2"> <button type="button" class="ml-2 text-red-600 hover:text-red-800 remove-option"> Remove </button> </div> @endif </div> <button type="button" id="add-option" class="mt-2 text-blue-600 hover:text-blue-800"> + Add Option </button> @error('options') <p class="mt-1 text-sm text-red-600">{{ $message }}</p> @enderror </div> <!-- Rating Scale --> <div id="rating-section" class="mb-6" style="display: {{ old('type', $poll->type) === 'rating' ? 'block' : 'none' }}"> <label for="max_rating" class="block text-sm font-medium text-gray-700 mb-2"> Maximum Rating * </label> <select name="max_rating" id="max_rating" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"> @for ($i = 2; $i <= 10; $i++) <option value="{{ $i }}" {{ old('max_rating', $poll->max_rating) == $i ? 'selected' : '' }}> 1 to {{ $i }} </option> @endfor </select> @error('max_rating') <p class="mt-1 text-sm text-red-600">{{ $message }}</p> @enderror </div> <!-- Anonymous Voting --> <div class="mb-6"> <label class="flex items-center"> <input type="checkbox" name="anonymous" value="1" {{ old('anonymous', $poll->anonymous) ? 'checked' : '' }} class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"> <span class="ml-2 text-sm text-gray-700">Anonymous voting (responses won't be linked to users)</span> </label> @error('anonymous') <p class="mt-1 text-sm text-red-600">{{ $message }}</p> @enderror </div> @else <!-- Show current settings for polls with responses --> <div class="mb-6 p-4 bg-gray-50 rounded-lg"> <h4 class="font-medium text-gray-700 mb-2">Current Poll Settings</h4> <div class="text-sm text-gray-600 space-y-1"> <p><strong>Type:</strong> {{ $poll->getTypeLabel() }}</p> @if ($poll->options) <p><strong>Options:</strong> {{ implode(', ', $poll->options) }}</p> @endif @if ($poll->max_rating) <p><strong>Rating Scale:</strong> 1 to {{ $poll->max_rating }}</p> @endif <p><strong>Anonymous:</strong> {{ $poll->anonymous ? 'Yes' : 'No' }}</p> </div> </div> @endif <!-- Settings --> <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"> <!-- Show Results --> <div> <label class="flex items-center"> <input type="checkbox" name="show_results" value="1" {{ old('show_results', $poll->show_results) ? 'checked' : '' }} class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"> <span class="ml-2 text-sm text-gray-700">Show results to voters</span> </label> </div> <!-- Allow Comments --> <div> <label class="flex items-center"> <input type="checkbox" name="allow_comments" value="1" {{ old('allow_comments', $poll->allow_comments) ? 'checked' : '' }} class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"> <span class="ml-2 text-sm text-gray-700">Allow comments with votes</span> </label> </div> </div> <!-- Visibility --> <div class="mb-6"> <label for="visibility" class="block text-sm font-medium text-gray-700 mb-2"> Who can see this poll? * </label> <select name="visibility" id="visibility" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" required> @foreach (\App\Models\Poll::getVisibilityOptions() as $value => $label) <option value="{{ $value }}" {{ old('visibility', $poll->visibility) === $value ? 'selected' : '' }}> {{ $label }} </option> @endforeach </select> </div> <!-- Department Selection --> <div id="department-section" class="mb-6" style="display: {{ old('visibility', $poll->visibility) === 'department' ? 'block' : 'none' }}"> <label class="block text-sm font-medium text-gray-700 mb-2"> Select Departments * </label> <div class="space-y-2 max-h-40 overflow-y-auto border border-gray-300 rounded-md p-3"> @foreach ($departments as $department) <label class="flex items-center"> <input type="checkbox" name="visible_departments[]" value="{{ $department }}" {{ in_array($department, old('visible_departments', $poll->visible_to ?? [])) ? 'checked' : '' }} class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"> <span class="ml-2 text-sm">{{ $department }}</span> </label> @endforeach </div> </div> <!-- User Selection --> <div id="user-section" class="mb-6" style="display: {{ old('visibility', $poll->visibility) === 'custom' ? 'block' : 'none' }}"> <label class="block text-sm font-medium text-gray-700 mb-2"> Select Users * </label> <div class="space-y-2 max-h-60 overflow-y-auto border border-gray-300 rounded-md p-3"> @foreach ($users->groupBy('department') as $department => $departmentUsers) <div class="mb-3"> <h4 class="font-medium text-gray-700 mb-1">{{ $department ?: 'No Department' }}</h4> @foreach ($departmentUsers as $user) <label class="flex items-center ml-4"> <input type="checkbox" name="visible_users[]" value="{{ $user->id }}" {{ in_array($user->id, old('visible_users', $poll->visible_to ?? [])) ? 'checked' : '' }} class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"> <span class="ml-2 text-sm">{{ $user->name }}</span> </label> @endforeach </div> @endforeach </div> </div> <!-- Status --> <div class="mb-6"> <label for="status" class="block text-sm font-medium text-gray-700 mb-2"> Status * </label> <select name="status" id="status" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" required> <option value="draft" {{ old('status', $poll->status) === 'draft' ? 'selected' : '' }}>Draft </option> <option value="active" {{ old('status', $poll->status) === 'active' ? 'selected' : '' }}>Active </option> <option value="closed" {{ old('status', $poll->status) === 'closed' ? 'selected' : '' }}>Closed </option> <option value="archived" {{ old('status', $poll->status) === 'archived' ? 'selected' : '' }}> Archived</option> </select> </div> <!-- Schedule --> <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"> <div> <label for="starts_at" class="block text-sm font-medium text-gray-700 mb-2"> Start Date (optional) </label> <input type="datetime-local" name="starts_at" id="starts_at" value="{{ old('starts_at', $poll->starts_at?->format('Y-m-d\TH:i')) }}" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"> </div> <div> <label for="ends_at" class="block text-sm font-medium text-gray-700 mb-2"> End Date (optional) </label> <input type="datetime-local" name="ends_at" id="ends_at" value="{{ old('ends_at', $poll->ends_at?->format('Y-m-d\TH:i')) }}" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"> </div> </div> <!-- Buttons --> <div class="flex items-center justify-between"> <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded"> Update Poll </button> <div class="flex gap-2"> <a href="{{ route('polls.show', $poll) }}" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded"> Cancel </a> @if ($poll->canManage(auth()->user())) <form method="POST" action="{{ route('polls.destroy', $poll) }}" onsubmit="return confirm('Are you sure you want to delete this poll? This action cannot be undone.')" class="inline"> @csrf @method('DELETE') <button type="submit" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"> Delete Poll </button> </form> @endif </div> </div> </form> </div> </div> @push('scripts') <script> document.addEventListener('DOMContentLoaded', function() { const typeSelect = document.getElementById('type'); const optionsSection = document.getElementById('options-section'); const ratingSection = document.getElementById('rating-section'); const visibilitySelect = document.getElementById('visibility'); const departmentSection = document.getElementById('department-section'); const userSection = document.getElementById('user-section'); const optionsContainer = document.getElementById('options-container'); const addOptionBtn = document.getElementById('add-option'); // Handle poll type changes function toggleSections() { const type = typeSelect.value; optionsSection.style.display = ['single_choice', 'multiple_choice'].includes(type) ? 'block' : 'none'; ratingSection.style.display = type === 'rating' ? 'block' : 'none'; } // Handle visibility changes function toggleVisibilitySections() { const visibility = visibilitySelect.value; departmentSection.style.display = visibility === 'department' ? 'block' : 'none'; userSection.style.display = visibility === 'custom' ? 'block' : 'none'; } // Add option functionality if (addOptionBtn) { addOptionBtn.addEventListener('click', function() { const optionRows = optionsContainer.querySelectorAll('.option-row'); const newIndex = optionRows.length; const newRow = document.createElement('div'); newRow.className = 'flex items-center mb-2 option-row'; newRow.innerHTML = ` <input type="text" name="options[]" class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50" placeholder="Option ${newIndex + 1}"> <button type="button" class="ml-2 text-red-600 hover:text-red-800 remove-option"> Remove </button> `; optionsContainer.appendChild(newRow); }); } // Remove option functionality optionsContainer.addEventListener('click', function(e) { if (e.target.classList.contains('remove-option')) { const optionRows = optionsContainer.querySelectorAll('.option-row'); if (optionRows.length > 2) { e.target.closest('.option-row').remove(); } else { alert('You must have at least 2 options.'); } } }); // Initialize sections typeSelect.addEventListener('change', toggleSections); visibilitySelect.addEventListener('change', toggleVisibilitySections); toggleSections(); toggleVisibilitySections(); }); </script> @endsection 
